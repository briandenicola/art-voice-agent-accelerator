# ═══════════════════════════════════════════════════════════════════════════════
# Decline Specialist Agent - Unified Schema
# ═══════════════════════════════════════════════════════════════════════════════
# Handles debit card decline inquiries and resolution
# Provides policy pack information, customer service scripts, and escalation support
# Works with both SpeechCascade and VoiceLive orchestrators
# ═══════════════════════════════════════════════════════════════════════════════

name: DeclineSpecialist
description: |
  Specialist agent for handling debit card decline inquiries.
  Looks up decline codes, provides customer service scripts, explains reasons for declines,
  offers resolution options based on policy pack data, and escalates when needed.

greeting: |
  I'm here to help you understand why your debit card was declined and what we can do about it.
  Can you tell me what happened when you tried to use your card?

return_greeting: |
  Welcome back to the Decline Specialist desk. What else can I help you with regarding your card?

# ─────────────────────────────────────────────────────────────────────────────
# Handoff Configuration
# ─────────────────────────────────────────────────────────────────────────────
handoff:
  trigger: handoff_decline_specialist  # Other agents call this to reach DeclineSpecialist

# ─────────────────────────────────────────────────────────────────────────────
# Model Configuration (overrides _defaults.yaml)
# ─────────────────────────────────────────────────────────────────────────────
model:
  temperature: 0.6                   # Lower for consistent, accurate decline explanations

# ─────────────────────────────────────────────────────────────────────────────
# Voice Configuration
# ─────────────────────────────────────────────────────────────────────────────
voice:
  name: en-US-EmmaMultilingualNeural  # Clear, trustworthy voice
  type: azure-standard
  rate: "-2%"

# ─────────────────────────────────────────────────────────────────────────────
# Session Configuration (VoiceLive-specific)
# ─────────────────────────────────────────────────────────────────────────────
session:
  modalities: [TEXT, AUDIO]
  input_audio_format: PCM16
  output_audio_format: PCM16

  input_audio_transcription_settings:
    model: gpt-4o-transcribe
    language: en-US

  turn_detection:
    type: azure_semantic_vad
    threshold: 0.5
    prefix_padding_ms: 240
    silence_duration_ms: 720

  tool_choice: auto

# ─────────────────────────────────────────────────────────────────────────────
# MCP Servers (external tool providers)
# ─────────────────────────────────────────────────────────────────────────────
mcp_servers:
  - cardapi                    # Card decline codes MCP server

# ─────────────────────────────────────────────────────────────────────────────
# Tools (referenced by name from shared registry)
# ─────────────────────────────────────────────────────────────────────────────
tools:
  # Decline Code Lookup & Search (MCP tools from cardapi server)
  - cardapi_lookup_decline_code
  - cardapi_search_decline_codes
  - cardapi_get_all_decline_codes
  - cardapi_get_decline_codes_metadata
  
  # Knowledge Base for additional context
  - search_knowledge_base
  
  # Additional transaction/account information
  - get_recent_transactions
  - get_account_summary
  
  # Customer service & resolution tools
  - ship_replacement_card
  - verify_client_identity
  
  # Email summary (send before fraud escalation or on request)
  - send_decline_summary_email
  
  # Handoffs (for escalation or routing)
  - handoff_concierge        # Return to concierge (banking scenario)
  - escalate_human           # Escalate to human agent
  - handoff_fraud_agent      # For suspected fraud cases (AFTER asking user consent)

# ─────────────────────────────────────────────────────────────────────────────
# Prompt Configuration
# ─────────────────────────────────────────────────────────────────────────────
prompts:
  path: prompt.jinja
